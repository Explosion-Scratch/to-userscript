// ==UserScript==
// @name        Cloud To Butt Plus
// @version     1.2
// @description Replaces the text 'the cloud' with 'my butt', as well as 'cloud' with 'butt' in certain contexts.
// @namespace   cloud-to-butt-plus
// @author      Converter Script
// @require     data:text/javascript;base64,Ly8gTmVlZGVkIG9uIHNvbWUgc2l0ZXMgZm9yIHNjcmlwdHMgdG8gc2V0IC5pbm5lckhUTUwgb2YgdGhpbmdzLgpjb25zdCBvdmVyd3JpdGVfZGVmYXVsdCA9IHRydWU7CmNvbnN0IHBhc3NUaHJvdWdoRnVuYyA9IChzdHJpbmcpID0+IHN0cmluZzsKY29uc3QgVFRQTmFtZSA9ICJwYXNzdGhyb3VnaCI7CmxldCBUVFBfZGVmYXVsdCwKICBUVFAgPSB7CiAgICBjcmVhdGVIVE1MOiBwYXNzVGhyb3VnaEZ1bmMsCiAgICBjcmVhdGVTY3JpcHQ6IHBhc3NUaHJvdWdoRnVuYywKICAgIGNyZWF0ZVNjcmlwdFVSTDogcGFzc1Rocm91Z2hGdW5jLAogIH07CmxldCBuZWVkc1RydXN0ZWRIVE1MID0gZmFsc2U7Cgpjb25zdCBkb2l0ID0gKCkgPT4gewogIHRyeSB7CiAgICBpZiAoCiAgICAgIHR5cGVvZiB3aW5kb3cuaXNTZWN1cmVDb250ZXh0ICE9PSAidW5kZWZpbmVkIiAmJgogICAgICB3aW5kb3cuaXNTZWN1cmVDb250ZXh0CiAgICApIHsKICAgICAgaWYgKHdpbmRvdy50cnVzdGVkVHlwZXMgJiYgd2luZG93LnRydXN0ZWRUeXBlcy5jcmVhdGVQb2xpY3kpIHsKICAgICAgICBuZWVkc1RydXN0ZWRIVE1MID0gdHJ1ZTsKICAgICAgICBpZiAodHJ1c3RlZFR5cGVzLmRlZmF1bHRQb2xpY3kpIHsKICAgICAgICAgIGxvZygiVFQgRGVmYXVsdCBQb2xpY3kgZXhpc3RzIik7CiAgICAgICAgICBpZiAob3ZlcndyaXRlX2RlZmF1bHQpCiAgICAgICAgICAgIFRUUCA9IHdpbmRvdy50cnVzdGVkVHlwZXMuY3JlYXRlUG9saWN5KCJkZWZhdWx0IiwgVFRQKTsKICAgICAgICAgIGVsc2UgVFRQID0gd2luZG93LnRydXN0ZWRUeXBlcy5jcmVhdGVQb2xpY3koVFRQTmFtZSwgVFRQKTsKICAgICAgICAgIFRUUF9kZWZhdWx0ID0gdHJ1c3RlZFR5cGVzLmRlZmF1bHRQb2xpY3k7CiAgICAgICAgICBsb2coCiAgICAgICAgICAgIGBDcmVhdGVkIGN1c3RvbSBwYXNzdGhyb3VnaCBwb2xpY3ksIGluIGNhc2UgdGhlIGRlZmF1bHQgcG9saWN5IGlzIHRvbyByZXN0cmljdGl2ZTogVXNlIFBvbGljeSAnJHtUVFBOYW1lfScgaW4gdmFyICdUVFAnOmAsCiAgICAgICAgICAgIFRUUCwKICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIFRUUF9kZWZhdWx0ID0gVFRQID0gd2luZG93LnRydXN0ZWRUeXBlcy5jcmVhdGVQb2xpY3koImRlZmF1bHQiLCBUVFApOwogICAgICAgIH0KICAgICAgICBsb2coIlRydXN0ZWQtVHlwZSBQb2xpY2llczogVFRQOiIsIFRUUCwgIlRUUF9kZWZhdWx0OiIsIFRUUF9kZWZhdWx0KTsKICAgICAgfQogICAgfQogIH0gY2F0Y2ggKGUpIHsKICAgIGxvZyhlKTsKICB9Cn07Cgpjb25zdCBsb2cgPSAoLi4uYXJncykgPT4gewogIGNvbnNvbGUubG9nKC4uLmFyZ3MpOwp9OwoKZG9pdCgpOwo=
// @match       *://*/*
// @grant       GM_setValue
// @grant       GM_getValue
// @grant       GM_listValues
// @grant       GM_deleteValue
// @grant       GM_xmlhttpRequest
// @grant       GM_registerMenuCommand
// @grant       GM_openInTab
// @run-at      document-end
// ==/UserScript==

(function(){function createEventBus(scopeId,type="page",{allowedOrigin="*",children=[],parentWindow=null}={},){if(!scopeId)throw new Error("createEventBus requires a scopeId");const handlers={};function handleIncoming(ev){if(allowedOrigin!=="*"&&ev.origin!==allowedOrigin)return;const msg=ev.data;if(!msg||msg.__eventBus!==true||msg.scopeId!==scopeId)return;const{event,payload}=msg;if(type==="page"&&event==="__INIT__"){const win=ev.source;if(win&&!children.includes(win)){children.push(win)}return}(handlers[event]||[]).forEach((fn)=>fn(payload,{origin:ev.origin,source:ev.source}),)}window.addEventListener("message",handleIncoming);function emitTo(win,event,payload){const envelope={__eventBus:true,scopeId,event,payload,};win.postMessage(envelope,allowedOrigin)}if(type==="iframe"){setTimeout(()=>{const pw=parentWindow||window.parent;if(pw&&pw.postMessage){emitTo(pw,"__INIT__",null)}},0)}return{on(event,fn){handlers[event]=handlers[event]||[];handlers[event].push(fn)},off(event,fn){if(!handlers[event])return;handlers[event]=handlers[event].filter((h)=>h!==fn)},emit(event,payload){(handlers[event]||[]).forEach((fn)=>fn(payload,{origin:location.origin,source:window}),);if(type==="page"){children.forEach((win)=>emitTo(win,event,payload))}else{const pw=parentWindow||window.parent;if(pw&&pw.postMessage){emitTo(pw,event,payload)}}},}}function createRuntime(type="background",bus){let nextId=1;const pending={};const msgListeners=[];let nextPortId=1;const ports={};const onConnectListeners=[];function parseArgs(args){let target,message,options,callback;const arr=[...args];if(arr.length===0){throw new Error("sendMessage requires at least one argument")}if(arr.length&&typeof arr[arr.length-1]==="object"&&!Array.isArray(arr[arr.length-1])){options=arr.pop()}if(arr.length&&typeof arr[arr.length-1]==="function"){callback=arr.pop()}if(arr.length===2&&(typeof arr[0]==="string"||typeof arr[0]==="number")){[target,message]=arr}else{[message]=arr}return{target,message,options,callback}}if(type==="background"){bus.on("__REQUEST__",({id,message},_)=>{let responded=false,isAsync=false;function sendResponse(resp){if(responded)return;responded=true;bus.emit("__RESPONSE__",{id,response:resp})}const results=msgListeners .map((fn)=>{try{const ret=fn(message,sendResponse);if(ret===true||(ret&&typeof ret.then==="function")){isAsync=true;return ret}return ret}catch(e){console.error(e)}}).filter((r)=>r!==undefined);const promises=results.filter((r)=>r&&typeof r.then==="function",);if(!isAsync&&promises.length===0){const out=results.length===1?results[0]:results;sendResponse(out)}else if(promises.length){Promise.all(promises).then((vals)=>{if(!responded){const out=vals.length===1?vals[0]:vals;sendResponse(out)}})}})}if(type!=="background"){bus.on("__RESPONSE__",({id,response})=>{const entry=pending[id];if(!entry)return;entry.resolve(response);if(entry.callback)entry.callback(response);delete pending[id]})}function sendMessage(...args){if(type==="background"){throw new Error("Background cannot sendMessage to itself")}const{target,message,callback}=parseArgs(args);const id=nextId++;const promise=new Promise((resolve)=>{pending[id]={resolve,callback};bus.emit("__REQUEST__",{id,message})});return promise}bus.on("__PORT_CONNECT__",({portId,name},{source})=>{if(type!=="background")return;const backgroundPort=makePort("background",portId,name,source);ports[portId]=backgroundPort;onConnectListeners.forEach((fn)=>fn(backgroundPort));bus.emit("__PORT_CONNECT_ACK__",{portId,name},{to:source})});bus.on("__PORT_CONNECT_ACK__",({portId,name},{source})=>{if(type==="background")return;const p=ports[portId];if(!p)return;p._ready=true;p._drainBuffer()});bus.on("__PORT_MESSAGE__",({portId,msg},{source})=>{const p=ports[portId];if(!p)return;p._receive(msg)});bus.on("__PORT_DISCONNECT__",({portId},{source})=>{const p=ports[portId];if(!p)return;p._disconnect();delete ports[portId]});function makePort(side,portId,name,remoteWindow){let onMessageHandlers=[];let onDisconnectHandlers=[];let buffer=[];let _ready=side==="background";function _drainBuffer(){buffer.forEach((m)=>_post(m));buffer=[]}function _post(msg){bus.emit("__PORT_MESSAGE__",{portId,msg},{to:remoteWindow})}function postMessage(msg){if(!_ready){buffer.push(msg)}else{_post(msg)}}function _receive(msg){onMessageHandlers.forEach((fn)=>fn(msg))}function disconnect(){bus.emit("__PORT_DISCONNECT__",{portId},{to:remoteWindow});_disconnect();delete ports[portId]}function _disconnect(){onDisconnectHandlers.forEach((fn)=>fn());onMessageHandlers=[];onDisconnectHandlers=[]}return{name,onMessage:{addListener(fn){onMessageHandlers.push(fn)},removeListener(fn){onMessageHandlers=onMessageHandlers.filter((x)=>x!==fn)},},onDisconnect:{addListener(fn){onDisconnectHandlers.push(fn)},removeListener(fn){onDisconnectHandlers=onDisconnectHandlers.filter((x)=>x!==fn)},},postMessage,disconnect,_ready,_drainBuffer,}}function connect(connectInfo={}){if(type==="background"){throw new Error("Background must use onConnect,not connect()")}const name=connectInfo.name||"";const portId=nextPortId++;const clientPort=makePort("client",portId,name,null);ports[portId]=clientPort;bus.emit("__PORT_CONNECT__",{portId,name});return clientPort}function onConnect(fn){if(type!=="background"){throw new Error("connect event only fires in background")}onConnectListeners.push(fn)}return{sendMessage,onMessage:{addListener(fn){msgListeners.push(fn)},removeListener(fn){const i=msgListeners.indexOf(fn);if(i>=0)msgListeners.splice(i,1)},},connect,onConnect:{addListener(fn){onConnect(fn)},removeListener(fn){const i=onConnectListeners.indexOf(fn);if(i>=0)onConnectListeners.splice(i,1)},},}}(function(){const pendingRequests=new Map();let nextRequestId=1;window.addEventListener("message",async(event)=>{const{type,requestId,method,args}=event.data;if(type==="abstraction-request"){try{let result;switch(method){case "_storageSet":result=await _storageSet(args[0]);break;case "_storageGet":result=await _storageGet(args[0]);break;case "_storageRemove":result=await _storageRemove(args[0]);break;case "_storageClear":result=await _storageClear();break;case "_fetch":result=await _fetch(args[0],args[1]);break;case "_registerMenuCommand":result=_registerMenuCommand(args[0],args[1]);break;case "_openTab":result=_openTab(args[0]);break;case "_initStorage":result=await _initStorage();break;default:throw new Error(`Unknown abstraction method:${method}`)}event.source.postMessage({type:"abstraction-response",requestId,success:true,result,})}catch(error){event.source.postMessage({type:"abstraction-response",requestId,success:false,error:{message:error.message,stack:error.stack,},})}}});console.log("[PostMessage Handler] Abstraction layer message handler initialized",)})();async function _storageSet(items){try{for(const key in items){if(items.hasOwnProperty(key)){await GM_setValue(key,items[key])}}return Promise.resolve()}catch(e){console.error("GM_setValue error:",e);return Promise.reject(e)}}async function _storageGet(keys){if(!keys){keys=null}if(Array.isArray(keys)&&(keys.length===0||[null,undefined].includes(keys[0]))){keys=null}try{const results={};let keyList=[];let defaults={};let requestedKeys=[];if(keys===null){keyList=await GM_listValues();requestedKeys=[...keyList]}else if(typeof keys==="string"){keyList=[keys];requestedKeys=[keys]}else if(Array.isArray(keys)){keyList=keys;requestedKeys=[...keys]}else if(typeof keys==="object"&&keys!==null){keyList=Object.keys(keys);requestedKeys=[...keyList];defaults=keys}else{console.error("_storageGet error:Invalid keys format",keys);return Promise.reject(new Error("Invalid keys format for get"))}for(const key of keyList){const defaultValue=defaults.hasOwnProperty(key)?defaults[key]:undefined;const storedValue=await GM_getValue(key,defaultValue);results[key]=storedValue}const finalResult={};for(const key of requestedKeys){if(results.hasOwnProperty(key)){finalResult[key]=results[key]}else if(defaults.hasOwnProperty(key)){finalResult[key]=defaults[key]}}return Promise.resolve(finalResult)}catch(e){console.error("GM_getValue/GM_listValues error:",e);return Promise.reject(e)}}async function _storageRemove(keysToRemove){try{let keyList=[];if(typeof keysToRemove==="string"){keyList=[keysToRemove]}else if(Array.isArray(keysToRemove)){keyList=keysToRemove}else{console.error("_storageRemove error:Invalid keys format",keysToRemove,);return Promise.reject(new Error("Invalid keys format for remove"))}for(const key of keyList){await GM_deleteValue(key)}return Promise.resolve()}catch(e){console.error("GM_deleteValue error:",e);return Promise.reject(e)}}async function _storageClear(){try{const keys=await GM_listValues();await Promise.all(keys.map((key)=>GM_deleteValue(key)));return Promise.resolve()}catch(e){console.error("GM_listValues/GM_deleteValue error during clear:",e);return Promise.reject(e)}}async function _fetch(url,options={}){return new Promise((resolve,reject)=>{try{GM_xmlhttpRequest({method:options.method||"GET",url:url,headers:options.headers||{},data:options.body,responseType:options.responseType,timeout:options.timeout||0,binary:options.responseType==="blob"||options.responseType==="arraybuffer",onload:function(response){const responseHeaders={};if(response.responseHeaders){response.responseHeaders .trim().split("\\r\\n").forEach((header)=>{const parts=header.match(/^([^:]+):\s*(.*)$/);if(parts&&parts.length===3){responseHeaders[parts[1].toLowerCase()]=parts[2]}})}const mockResponse={ok:response.status>=200&&response.status<300,status:response.status,statusText:response.statusText||(response.status>=200&&response.status<300?"OK":""),url:response.finalUrl||url,headers:new Headers(responseHeaders),text:()=>Promise.resolve(response.responseText),json:()=>{try{return Promise.resolve(JSON.parse(response.responseText))}catch(e){return Promise.reject(new SyntaxError("Could not parse JSON"),)}},blob:()=>{if(response.response instanceof Blob){return Promise.resolve(response.response)}return Promise.reject(new Error("Requires responseType:'blob' in GM_xmlhttpRequest",),)},arrayBuffer:()=>{if(response.response instanceof ArrayBuffer){return Promise.resolve(response.response)}return Promise.reject(new Error("Requires responseType:'arraybuffer' in GM_xmlhttpRequest",),)},clone:function(){const cloned={...this};cloned.text=()=>Promise.resolve(response.responseText);cloned.json=()=>this.json();cloned.blob=()=>this.blob();cloned.arrayBuffer=()=>this.arrayBuffer();return cloned},};if(mockResponse.ok){resolve(mockResponse)}else{const error=new Error(`HTTP error!status:${response.status}`);error.response=mockResponse;reject(error)}},onerror:function(response){reject(new Error(`GM_xmlhttpRequest network error:${response.statusText||"Unknown Error"}`,),)},onabort:function(){reject(new Error("GM_xmlhttpRequest aborted"))},ontimeout:function(){reject(new Error("GM_xmlhttpRequest timed out"))},})}catch(e){console.error("_fetch(GM_xmlhttpRequest)error:",e);reject(e)}})}function _registerMenuCommand(name,func){if(typeof GM_registerMenuCommand==="function"){try{GM_registerMenuCommand(name,func)}catch(e){console.error("GM_registerMenuCommand failed:",e)}}else{console.warn("GM_registerMenuCommand not available.")}}function _openTab(url){if(typeof GM_openInTab==="function"){try{GM_openInTab(url,{active:true})}catch(e){console.error("GM_openInTab failed:",e)}}else{console.warn("GM_openInTab not available,using window.open as fallback.",);try{window.open(url)}catch(e){console.error("window.open fallback failed:",e)}}}async function _initStorage(){return Promise.resolve()}const EXTENSION_ASSETS_MAP={};function _base64ToBlob(){return null}function _getMimeTypeFromPath(){return "application/octet-stream"}function _isTextAsset(){return false}function _createAssetUrl(){return ""}function buildPolyfill({isBackground=false,isOtherPage=false}={}){const contextType=isBackground?"background":isOtherPage?"options":"content";const contextId=`${contextType}_${Math.random().toString(36).substring(2,15)}`;const IS_IFRAME="false"==="true";const BUS=createEventBus("cloud-to-butt-plus",IS_IFRAME?"iframe":"page",);const RUNTIME=createRuntime(isBackground?"background":"tab",BUS);const storageChangeListeners=new Set();function broadcastStorageChange(changes,areaName){storageChangeListeners.forEach((listener)=>{listener(changes,areaName)})}let chrome={extension:{isAllowedIncognitoAccess:()=>Promise.resolve(true),sendMessage:(...args)=>_messagingHandler.sendMessage(...args),},permissions:{request:(permissions,callback)=>{callback(permissions)},contains:(permissions)=>{return true},},i18n:{getMessage:(key)=>{if(typeof LOCALE_KEYS!=="undefined"&&LOCALE_KEYS[key]){return LOCALE_KEYS[key].message}return key},},runtime:{...RUNTIME,getManifest:()=>{if(typeof INJECTED_MANIFEST!=="undefined"){return JSON.parse(JSON.stringify(INJECTED_MANIFEST))}console.warn("INJECTED_MANIFEST not found for chrome.runtime.getManifest",);return{name:"Unknown",version:"0.0",manifest_version:2}},getURL:(path)=>{if(!path)return "";if(path.startsWith("/")){path=path.substring(1)}if(typeof _createAssetUrl==="function"){return _createAssetUrl(path)}console.warn(`chrome.runtime.getURL fallback for '${path}'. Assets may not be available.`,);try{if(window.location.protocol.startsWith("http")){return new URL(path,window.location.href).toString()}}catch(e){}return path},id:"polyfilled-extension-"+Math.random().toString(36).substring(2,15),lastError:null,getPlatformInfo:async()=>{const platform={os:"unknown",arch:"unknown",nacl_arch:"unknown",};if(typeof navigator!=="undefined"){const userAgent=navigator.userAgent.toLowerCase();if(userAgent.includes("mac"))platform.os="mac";else if(userAgent.includes("win"))platform.os="win";else if(userAgent.includes("linux"))platform.os="linux";else if(userAgent.includes("android"))platform.os="android";else if(userAgent.includes("ios"))platform.os="ios";if(userAgent.includes("x86_64")||userAgent.includes("amd64")){platform.arch="x86-64"}else if(userAgent.includes("i386")||userAgent.includes("i686")){platform.arch="x86-32"}else if(userAgent.includes("arm")){platform.arch="arm"}}return platform},getBrowserInfo:async()=>{const info={name:"unknown",version:"unknown",buildID:"unknown",};if(typeof navigator!=="undefined"){const userAgent=navigator.userAgent;if(userAgent.includes("Chrome")){info.name="Chrome";const match=userAgent.match(/Chrome\/([0-9.]+)/);if(match)info.version=match[1]}else if(userAgent.includes("Firefox")){info.name="Firefox";const match=userAgent.match(/Firefox\/([0-9.]+)/);if(match)info.version=match[1]}else if(userAgent.includes("Safari")){info.name="Safari";const match=userAgent.match(/Version\/([0-9.]+)/);if(match)info.version=match[1]}}return info},},storage:{local:{get:function(keys,callback){if(typeof _storageGet!=="function")throw new Error("_storageGet not defined");const promise=_storageGet(keys);if(typeof callback==="function"){promise .then((result)=>{try{callback(result)}catch(e){console.error("Error in storage.get callback:",e)}}).catch((error)=>{console.error("Storage.get error:",error);callback({})});return}return promise},set:function(items,callback){if(typeof _storageSet!=="function")throw new Error("_storageSet not defined");const promise=_storageSet(items).then((result)=>{broadcastStorageChange(items,"local");return result});if(typeof callback==="function"){promise .then((result)=>{try{callback(result)}catch(e){console.error("Error in storage.set callback:",e)}}).catch((error)=>{console.error("Storage.set error:",error);callback()});return}return promise},remove:function(keys,callback){if(typeof _storageRemove!=="function")throw new Error("_storageRemove not defined");const promise=_storageRemove(keys).then((result)=>{const changes={};const keyList=Array.isArray(keys)?keys:[keys];keyList.forEach((key)=>{changes[key]={oldValue:undefined,newValue:undefined}});broadcastStorageChange(changes,"local");return result});if(typeof callback==="function"){promise .then((result)=>{try{callback(result)}catch(e){console.error("Error in storage.remove callback:",e)}}).catch((error)=>{console.error("Storage.remove error:",error);callback()});return}return promise},clear:function(callback){if(typeof _storageClear!=="function")throw new Error("_storageClear not defined");const promise=_storageClear().then((result)=>{broadcastStorageChange({},"local");return result});if(typeof callback==="function"){promise .then((result)=>{try{callback(result)}catch(e){console.error("Error in storage.clear callback:",e)}}).catch((error)=>{console.error("Storage.clear error:",error);callback()});return}return promise},onChanged:{addListener:(callback)=>{storageChangeListeners.add(callback)},removeListener:(callback)=>{storageChangeListeners.delete(callback)},},},sync:{get:function(keys,callback){console.warn("chrome.storage.sync polyfill maps to local");return chrome.storage.local.get(keys,callback)},set:function(items,callback){console.warn("chrome.storage.sync polyfill maps to local");const promise=chrome.storage.local.set(items).then((result)=>{broadcastStorageChange(items,"sync");return result});if(typeof callback==="function"){promise .then((result)=>{try{callback(result)}catch(e){console.error("Error in storage.sync.set callback:",e)}}).catch((error)=>{console.error("Storage.sync.set error:",error);callback()});return}return promise},remove:function(keys,callback){console.warn("chrome.storage.sync polyfill maps to local");const promise=chrome.storage.local.remove(keys).then((result)=>{const changes={};const keyList=Array.isArray(keys)?keys:[keys];keyList.forEach((key)=>{changes[key]={oldValue:undefined,newValue:undefined}});broadcastStorageChange(changes,"sync");return result});if(typeof callback==="function"){promise .then((result)=>{try{callback(result)}catch(e){console.error("Error in storage.sync.remove callback:",e)}}).catch((error)=>{console.error("Storage.sync.remove error:",error);callback()});return}return promise},clear:function(callback){console.warn("chrome.storage.sync polyfill maps to local");const promise=chrome.storage.local.clear().then((result)=>{broadcastStorageChange({},"sync");return result});if(typeof callback==="function"){promise .then((result)=>{try{callback(result)}catch(e){console.error("Error in storage.sync.clear callback:",e)}}).catch((error)=>{console.error("Storage.sync.clear error:",error);callback()});return}return promise},onChanged:{addListener:(callback)=>{storageChangeListeners.add(callback)},removeListener:(callback)=>{storageChangeListeners.delete(callback)},},},onChanged:{addListener:(callback)=>{storageChangeListeners.add(callback)},removeListener:(callback)=>{storageChangeListeners.delete(callback)},},managed:{get:function(keys,callback){console.warn("chrome.storage.managed polyfill is read-only empty.");const promise=Promise.resolve({});if(typeof callback==="function"){promise.then((result)=>{try{callback(result)}catch(e){console.error("Error in storage.managed.get callback:",e)}});return}return promise},},},tabs:{query:async(queryInfo)=>{console.warn("chrome.tabs.query polyfill only returns current tab info.",);const dummyId=Math.floor(Math.random()*1000)+1;return [{id:dummyId,url:window.location.href,active:true,windowId:1,status:"complete",},]},create:async({url})=>{console.log(`[Polyfill tabs.create] URL:${url}`);if(typeof _openTab!=="function")throw new Error("_openTab not defined");_openTab(url);const dummyId=Math.floor(Math.random()*1000)+1001;return Promise.resolve({id:dummyId,url:url,active:true,windowId:1,})},sendMessage:async(tabId,message)=>{console.warn(`chrome.tabs.sendMessage polyfill(to tab ${tabId})redirects to runtime.sendMessage(current context).`,);return chrome.runtime.sendMessage(message)},},notifications:{create:async(notificationId,options)=>{try{let id=notificationId;let notificationOptions=options;if(typeof notificationId==="object"&&notificationId!==null){notificationOptions=notificationId;id="notification_"+Math.random().toString(36).substring(2,15)}else if(typeof notificationId==="string"&&options){id=notificationId;notificationOptions=options}else{throw new Error("Invalid parameters for notifications.create")}if(!notificationOptions||typeof notificationOptions!=="object"){throw new Error("Notification options must be an object")}const{title,message,iconUrl,type="basic",}=notificationOptions;if(!title||!message){throw new Error("Notification must have title and message")}if("Notification" in window){if(Notification.permission==="granted"){const notification=new Notification(title,{body:message,icon:iconUrl,tag:id,});console.log(`[Notifications] Created notification:${id}`);return id}else if(Notification.permission==="default"){const permission=await Notification.requestPermission();if(permission==="granted"){const notification=new Notification(title,{body:message,icon:iconUrl,tag:id,});console.log(`[Notifications] Created notification after permission:${id}`,);return id}else{console.warn("[Notifications] Permission denied for notifications",);return id}}else{console.warn("[Notifications] Notifications are blocked");return id}}else{console.warn("[Notifications] Native notifications not supported,using console fallback",);console.log(`[Notification] ${title}:${message}`);return id}}catch(error){console.error("[Notifications] Error creating notification:",error.message,);throw error}},clear:async(notificationId)=>{console.log(`[Notifications] Clear notification:${notificationId}`);return true},getAll:async()=>{console.warn("[Notifications] getAll not fully supported in polyfill",);return{}},getPermissionLevel:async()=>{if("Notification" in window){const permission=Notification.permission;return{level:permission==="granted"?"granted":"denied"}}return{level:"denied"}},},contextMenus:{create:(createProperties,callback)=>{try{if(!createProperties||typeof createProperties!=="object"){throw new Error("Context menu create properties must be an object",)}const{id,title,contexts=["page"],onclick,}=createProperties;const menuId=id||`menu_${Math.random().toString(36).substring(2,15)}`;if(!title||typeof title!=="string"){throw new Error("Context menu must have a title")}if(!window._polyfillContextMenus){window._polyfillContextMenus=new Map()}window._polyfillContextMenus.set(menuId,{id:menuId,title,contexts,onclick,enabled:createProperties.enabled!==false,});console.log(`[ContextMenus] Created context menu item:${title}(${menuId})`,);if(typeof _registerMenuCommand==="function"){try{_registerMenuCommand(title,onclick||(()=>{console.log(`Context menu clicked:${title}`)}),)}catch(e){console.warn("[ContextMenus] Failed to register as menu command:",e.message,)}}if(callback&&typeof callback==="function"){setTimeout(()=>callback(),0)}return menuId}catch(error){console.error("[ContextMenus] Error creating context menu:",error.message,);if(callback&&typeof callback==="function"){setTimeout(()=>callback(),0)}throw error}},update:(id,updateProperties,callback)=>{try{if(!window._polyfillContextMenus||!window._polyfillContextMenus.has(id)){throw new Error(`Context menu item not found:${id}`)}const menuItem=window._polyfillContextMenus.get(id);Object.assign(menuItem,updateProperties);console.log(`[ContextMenus] Updated context menu item:${id}`);if(callback&&typeof callback==="function"){setTimeout(()=>callback(),0)}}catch(error){console.error("[ContextMenus] Error updating context menu:",error.message,);if(callback&&typeof callback==="function"){setTimeout(()=>callback(),0)}}},remove:(menuItemId,callback)=>{try{if(window._polyfillContextMenus&&window._polyfillContextMenus.has(menuItemId)){window._polyfillContextMenus.delete(menuItemId);console.log(`[ContextMenus] Removed context menu item:${menuItemId}`,)}else{console.warn(`[ContextMenus] Context menu item not found for removal:${menuItemId}`,)}if(callback&&typeof callback==="function"){setTimeout(()=>callback(),0)}}catch(error){console.error("[ContextMenus] Error removing context menu:",error.message,);if(callback&&typeof callback==="function"){setTimeout(()=>callback(),0)}}},removeAll:(callback)=>{try{if(window._polyfillContextMenus){const count=window._polyfillContextMenus.size;window._polyfillContextMenus.clear();console.log(`[ContextMenus] Removed all ${count}context menu items`,)}if(callback&&typeof callback==="function"){setTimeout(()=>callback(),0)}}catch(error){console.error("[ContextMenus] Error removing all context menus:",error.message,);if(callback&&typeof callback==="function"){setTimeout(()=>callback(),0)}}},onClicked:{addListener:(callback)=>{if(!window._polyfillContextMenuListeners){window._polyfillContextMenuListeners=new Set()}window._polyfillContextMenuListeners.add(callback);console.log("[ContextMenus] Added click listener")},removeListener:(callback)=>{if(window._polyfillContextMenuListeners){window._polyfillContextMenuListeners.delete(callback);console.log("[ContextMenus] Removed click listener")}},},},};const loggingProxyHandler=(_key)=>({get(target,key,receiver){console.log(`[${contextType}] [CHROME-${_key}] Getting ${key}`);return Reflect.get(target,key,receiver)},set(target,key,value,receiver){console.log(`[${contextType}] [CHROME-${_key}] Setting ${key}to ${value}`,);return Reflect.set(target,key,value,receiver)},has(target,key){console.log(`[${contextType}] [CHROME-${_key}] Checking if ${key}exists`,);return Reflect.has(target,key)},});chrome=Object.fromEntries(Object.entries(chrome).map(([key,value])=>[ key,new Proxy(value,loggingProxyHandler(key)),]),);const browser=new Proxy(chrome,loggingProxyHandler);const oldGlobalThis=globalThis;const oldWindow=window;const oldSelf=self;const oldGlobal=globalThis;const __globalsStorage={};const TO_MODIFY=[oldGlobalThis,oldWindow,oldSelf,oldGlobal];const set=(k,v)=>{__globalsStorage[k]=v;TO_MODIFY.forEach((target)=>{target[k]=v})};const proxyHandler={get(target,key,receiver){return __globalsStorage[key]||Reflect.get(target,key,receiver)},set(target,key,value,receiver){console.log(`[${contextType}] Setting ${key}to ${value}`);set(key,value);return Reflect.set(target,key,value,receiver)},has(target,key){return key in __globalsStorage||key in target},getOwnPropertyDescriptor(target,key){if(key in __globalsStorage){return{configurable:true,enumerable:true,writable:true,value:__globalsStorage[key],}}const desc=Reflect.getOwnPropertyDescriptor(target,key);if(desc&&!desc.configurable){desc.configurable=true}return desc},defineProperty(target,key,descriptor){const hasAccessor="get" in descriptor||"set" in descriptor;if(hasAccessor){const normalized={configurable:"configurable" in descriptor?descriptor.configurable:true,enumerable:"enumerable" in descriptor?descriptor.enumerable:false,};if("get" in descriptor)normalized.get=descriptor.get;if("set" in descriptor)normalized.set=descriptor.set;set(key,{get:descriptor.get,set:descriptor.set,});return Reflect.defineProperty(target,key,normalized)}set(key,descriptor.value);return Reflect.defineProperty(target,key,descriptor)},};const proxyWindow=new Proxy(oldWindow,proxyHandler);const proxyGlobalThis=new Proxy(oldGlobalThis,proxyHandler);const proxyGlobal=new Proxy(oldGlobal,proxyHandler);const proxySelf=new Proxy(oldSelf,proxyHandler);Object.assign(__globalsStorage,{chrome,browser,window:proxyWindow,globalThis:proxyGlobalThis,global:proxyGlobal,self:proxySelf,});const __globals={chrome,browser,window:proxyWindow,globalThis:proxyGlobalThis,global:proxyGlobal,self:proxySelf,__globals:__globalsStorage,};__globalsStorage.contextId=contextId;__globalsStorage.contextType=contextType;__globalsStorage.module=undefined;__globalsStorage.amd=undefined;__globalsStorage.define=undefined;return __globals}if(typeof window!=="undefined"){window.buildPolyfill=buildPolyfill}const SCRIPT_NAME="Cloud To Butt Plus";const INJECTED_MANIFEST={manifest_version:2,name:"Cloud To Butt Plus",version:"1.2",description:"Replaces the text 'the cloud' with 'my butt',as well as 'cloud' with 'butt' in certain contexts.",permissions:[],content_scripts:[{matches:["*:js:["content_script.js"],run_at:"document_end",css:[],},],options_ui:{},browser_action:{},page_action:{},action:{},icons:{},web_accessible_resources:[],_id:"cloud-to-butt-plus",};const CONTENT_SCRIPT_CONFIGS_FOR_MATCHING=[{matches:["*:},];const OPTIONS_PAGE_PATH=null;const POPUP_PAGE_PATH=null;const EXTENSION_ICON=null;const extensionCssData={};const LOCALE_KEYS={};const convertMatchPatternToRegExp=function convertMatchPatternToRegExp(pattern,){if(pattern==="<all_urls>"){return new RegExp(".*")}try{const singleEscapedPattern=convertMatchPatternToRegExpString(pattern,).replace(/\\\\/g,"\\");return new RegExp(singleEscapedPattern)}catch(error){console.error(`Error converting match pattern to RegExp:${pattern}`,error,);return new RegExp("$.")}};const convertMatchPatternToRegExpString=function convertMatchPatternToRegExpString(pattern){function escapeRegex(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\\\$&")}if(typeof pattern!=="string"||!pattern){return "$."}const schemeMatch=pattern.match(/^(\*|https?|file|ftp):\/\ if(!schemeMatch)return "$.";const scheme=schemeMatch[1];pattern=pattern.substring(schemeMatch[0].length);const schemeRegex=scheme==="*"?"https?|file|ftp":scheme;const hostMatch=pattern.match(/^([^\/]+)/);if(!hostMatch)return "$.";const host=hostMatch[1];pattern=pattern.substring(host.length);let hostRegex;if(host==="*"){hostRegex="[^/]+"}else if(host.startsWith("*.")){hostRegex="(?:[^\\/]+\\.)?"+escapeRegex(host.substring(2))}else{hostRegex=escapeRegex(host)}let pathRegex=pattern;if(!pathRegex.startsWith("/")){pathRegex="/"+pathRegex}pathRegex=pathRegex.split("*").map(escapeRegex).join(".*");if(pathRegex==="/.*"){pathRegex="(?:/.*)?"}else{pathRegex=pathRegex+"(?:[?#]|$)"}const finalRegexString=`^${schemeRegex}:\\/\\/${hostRegex}${pathRegex}`;return finalRegexString};function _matchGlobPattern(pattern,path){if(!pattern||!path)return false;pattern=pattern.replace(/\\/g,"/");path=path.replace(/\\/g,"/");if(pattern===path)return true;let regexPattern=pattern .replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*\*/g,"__DOUBLESTAR__").replace(/\*/g,"[^/]*").replace(/__DOUBLESTAR__/g,".*");regexPattern="^"+regexPattern+"$";try{const regex=new RegExp(regexPattern);return regex.test(path)}catch(e){console.error(`Invalid glob pattern:${pattern}`,e);return false}}function _isWebAccessibleResource(resourcePath,webAccessibleResources){if(!Array.isArray(webAccessibleResources)||webAccessibleResources.length===0){return false}const normalizedPath=resourcePath.replace(/\\/g,"/").replace(/^\/+/,"");for(const webAccessibleResource of webAccessibleResources){let patterns=[];if(typeof webAccessibleResource==="string"){patterns=[webAccessibleResource]}else if(webAccessibleResource&&Array.isArray(webAccessibleResource.resources)){patterns=webAccessibleResource.resources}for(const pattern of patterns){if(_matchGlobPattern(pattern,normalizedPath)){return true}}}return false}window._matchGlobPattern=_matchGlobPattern;window._isWebAccessibleResource=_isWebAccessibleResource;async function executeAllScripts(globalThis,extensionCssData){const{chrome,browser,global,window,self}=globalThis;const scriptName="Cloud To Butt Plus";console.log(`[${scriptName}] Starting execution phases...`);if(typeof document!=="undefined"){console.log(`[${scriptName}] Executing document-start phase...`);const scriptPaths=[];console.log(` Executing JS(start):${scriptPaths}`);try{with(globalThis){}}catch(e){console.error(` Error executing scripts ${scriptPaths}`,e)}}else{console.log(`[${scriptName}] Skipping document-start phase(no document).`,)}if(typeof document!=="undefined"){console.log(`[${scriptName}] Executing document-end phase...`);const scriptPaths=["content_script.js"];console.log(` Executing JS(end):${scriptPaths}`);try{with(globalThis){walk(document.body);function walk(node){//http:var child,next;switch(node.nodeType){case 1:case 9:case 11:child=node.firstChild;while(child){next=child.nextSibling;walk(child);child=next}break;case 3:if(node.parentElement.tagName.toLowerCase()!="script"){handleText(node)}break}}function handleText(textNode){var v=textNode.nodeValue;v=v.replace(/\b(T|t)he(C|c)loud/g,function(match,p1,p2,offset,string){m=String.fromCharCode(p1.charCodeAt(0)-7);b=String.fromCharCode(p2.charCodeAt(0)-1);return m+"y "+b+"utt"},);v=v.replace(/\b(P|p)rivate(C|c)loud/g,function(match,p1,p2,offset,string){b=String.fromCharCode(p2.charCodeAt(0)-1);return b+"utt"},);if(v.match(/cloud/i)){if(v.match(/PaaS|SaaS|IaaS|computing|data|storage|cluster|distributed|server|hosting|provider|grid|enterprise|provision|apps|hardware|software|/i,)){v=v.replace(/(C|c)loud/gi,function(match,p1,offset,string){b=String.fromCharCode(p1.charCodeAt(0)-1);return b+"utt"},)}}textNode.nodeValue=v}}}catch(e){console.error(` Error executing scripts ${scriptPaths}`,e)}}else{console.log(`[${scriptName}] Skipping document-end phase(no document).`)}if(typeof document!=="undefined"){console.log(`[${scriptName}] Executing document-idle phase...`);const scriptPaths=[];console.log(` Executing JS(idle):${scriptPaths}`);try{with(globalThis){}}catch(e){console.error(` Error executing scripts ${scriptPaths}`,e)}}else{console.log(`[${scriptName}] Skipping document-idle phase(no document).`,)}console.log(`[${scriptName}] All execution phases complete,re-firing load events.`,);document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:true,cancelable:true,}),)}function closeOptionsModal(){const DURATION=100;const backdrop=document.getElementById("extension-options-backdrop");const modal=document.getElementById("extension-options-modal");if(!backdrop||!modal)return;modal.style.animation=`modalCloseAnimation ${DURATION/1000}s ease-out forwards`;backdrop.style.animation=`backdropFadeOut ${DURATION/1000}s ease-out forwards`;setTimeout(()=>{if(confirm("Close options and reload the page?")){window.location.reload()}else{backdrop.remove()}},DURATION)}function closePopupModal(){const DURATION=100;const backdrop=document.getElementById("extension-popup-backdrop");const modal=document.getElementById("extension-popup-modal");if(!backdrop||!modal)return;modal.style.animation=`modalCloseAnimation ${DURATION/1000}s ease-out forwards`;backdrop.style.animation=`backdropFadeOut ${DURATION/1000}s ease-out forwards`;setTimeout(()=>{backdrop.remove()},DURATION)}function openPopupPage(){if(!POPUP_PAGE_PATH||typeof EXTENSION_ASSETS_MAP==="undefined"){console.warn("No popup page available.");return}const html=EXTENSION_ASSETS_MAP[POPUP_PAGE_PATH];if(!html){console.warn("Popup HTML not found in asset map");return}let backdrop=document.getElementById("extension-popup-backdrop");let modal,iframe;if(!backdrop){backdrop=document.createElement("div");backdrop.id="extension-popup-backdrop";modal=document.createElement("div");modal.id="extension-popup-modal";const extensionName=INJECTED_MANIFEST.name||"Extension Popup";const iconSrc=EXTENSION_ICON||"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik00IDdoM2ExIDEgMCAwIDAgMSAtMXYtMWEyIDIgMCAwIDEgNCAwdjFhMSAxIDAgMCAwIDEgMWgzYTEgMSAwIDAgMSAxIDF2M2ExIDEgMCAwIDAgMSAxaDFhMiAyIDAgMCAxIDAgNGgtMWExIDEgMCAwIDAgLTEgMXYzYTEgMSAwIDAgMSAtMSAxaC0zYTEgMSAwIDAgMSAtMSAtMXYtMWEyIDIgMCAwIDAgLTQgMHYxYTEgMSAwIDAgMSAtMSAxaC0zYTEgMSAwIDAgMSAtMSAtMXYtM2ExIDEgMCAwIDEgMSAtMWgxYTIgMiAwIDAgMCAwIC00aC0xYTEgMSAwIDAgMSAtMSAtMXYtM2ExIDEgMCAwIDEgMSAtMSIgLz48L3N2Zz4=";backdrop.innerHTML=`<style>#extension-popup-backdrop{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.13);backdrop-filter:blur(3px);z-index:2147483646;display:flex;align-items:center;justify-content:center;animation:backdropFadeIn 0.3s ease-out forwards}#extension-popup-modal{width:400px;height:600px;max-width:calc(100vw-40px);max-height:calc(100vh-40px);z-index:2147483647;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;--background:#ffffff;--rad:10px;--border:#666;--border-thickness:2px;display:flex;flex-direction:column;overflow:hidden;animation:modalOpenAnimation 0.3s ease-out forwards}#extension-popup-modal .modal-header{display:flex;justify-content:space-between;align-items:flex-end;padding:0 16px;position:relative;flex-shrink:0}#extension-popup-modal .tab{padding:12px 16px;color:#606266;display:flex;align-items:center;gap:8px;font-size:14px;cursor:pointer;border-radius:var(--rad)var(--rad)0 0;transition:background-color 0.2s ease;user-select:none}#extension-popup-modal .tab.active,#extension-popup-modal .tab.close-button{background-color:var(--background);border:var(--border-thickness)solid var(--border);border-bottom-color:var(--background);margin-bottom:-1px;z-index:1;color:#303133;font-weight:500}#extension-popup-modal .tab.close-button{padding:8px}#extension-popup-modal .tab.close-button:hover{background-color:#f5f7fa}#extension-popup-modal .tab svg{stroke:currentColor}#extension-popup-modal .tab.active svg{width:16px;height:16px}#extension-popup-modal .tab.close-button svg{width:20px;height:20px}#extension-popup-modal .modal-content{flex-grow:1;position:relative;border-radius:var(--rad);overflow:hidden;bottom:calc(var(--border-thickness)-1px);border:var(--border-thickness)solid var(--border)}#extension-popup-modal .modal-content iframe{width:100%;height:100%;border:0;background:white}</style>`;modal.innerHTML=`<div class="modal-header"><div class="tab active"><img src="${iconSrc}" style="width:16px;height:16px;" onerror="this.style.display='none'"><span>${extensionName}</span></div><div class="tab close-button"><svg xmlns="http:<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="modal-content"><iframe></iframe></div>`;backdrop.appendChild(modal);backdrop.addEventListener("click",(e)=>{if(e.target===backdrop){closePopupModal()}});modal .querySelector(".tab.close-button").addEventListener("click",closePopupModal);document.body.appendChild(backdrop);iframe=modal.querySelector("iframe")}else{modal=backdrop.querySelector("#extension-popup-modal");iframe=modal.querySelector("iframe");if(!iframe){iframe=document.createElement("iframe");modal.querySelector(".modal-content").appendChild(iframe)}backdrop.style.display="flex"}try{const polyfillString=generateCompletePolyfillForIframe();const doc=new DOMParser().parseFromString(html,"text/html");const script=doc.createElement("script");script.textContent=polyfillString;doc.head.insertAdjacentElement("afterbegin",script);iframe.srcdoc=doc.documentElement.outerHTML}catch(e){console.error("Error generating complete polyfill for iframe",e);iframe.srcdoc=html}}function openOptionsPage(){if(!OPTIONS_PAGE_PATH||typeof EXTENSION_ASSETS_MAP==="undefined"){console.warn("No options page available.");return}const html=EXTENSION_ASSETS_MAP[OPTIONS_PAGE_PATH];if(!html){console.warn("Options HTML not found in asset map");return}let backdrop=document.getElementById("extension-options-backdrop");let modal,iframe;if(!backdrop){backdrop=document.createElement("div");backdrop.id="extension-options-backdrop";modal=document.createElement("div");modal.id="extension-options-modal";const extensionName=INJECTED_MANIFEST.name||"Extension Options";const iconSrc=EXTENSION_ICON||"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik00IDdoM2ExIDEgMCAwIDAgMSAtMXYtMWEyIDIgMCAwIDEgNCAwdjFhMSAxIDAgMCAwIDEgMWgzYTEgMSAwIDAgMSAxIDF2M2ExIDEgMCAwIDAgMSAxaDFhMiAyIDAgMCAxIDAgNGgtMWExIDEgMCAwIDAgLTEgMXYzYTEgMSAwIDAgMSAtMSAxaC0zYTEgMSAwIDAgMSAtMSAtMXYtMWEyIDIgMCAwIDAgLTQgMHYxYTEgMSAwIDAgMSAtMSAxaC0zYTEgMSAwIDAgMSAtMSAtMXYtM2ExIDEgMCAwIDEgMSAtMWgxYTIgMiAwIDAgMCAwIC00aC0xYTEgMSAwIDAgMSAtMSAtMXYtM2ExIDEgMCAwIDEgMSAtMSIgLz48L3N2Zz4=";backdrop.innerHTML=`<style>#extension-options-backdrop{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.13);backdrop-filter:blur(3px);z-index:2147483646;display:flex;align-items:center;justify-content:center;animation:backdropFadeIn 0.3s ease-out forwards}@keyframes backdropFadeIn{from{opacity:0;backdrop-filter:blur(0px)}to{opacity:1;backdrop-filter:blur(3px)}}@keyframes backdropFadeOut{from{opacity:1;backdrop-filter:blur(3px)}to{opacity:0;backdrop-filter:blur(0px)}}@keyframes modalOpenAnimation{from{transform:scaleY(0.8);opacity:0}to{transform:scaleY(1);opacity:1}}@keyframes modalCloseAnimation{from{transform:scaleY(1);opacity:1}to{transform:scaleY(0.8);opacity:0}}#extension-options-modal{width:calc(100vw-80px);height:calc(100vh-80px);max-width:1200px;max-height:800px;z-index:2147483647;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;--background:#ffffff;--rad:10px;--border:#666;--border-thickness:2px;display:flex;flex-direction:column;overflow:hidden;animation:modalOpenAnimation 0.3s ease-out forwards}#extension-options-modal .modal-header{display:flex;justify-content:space-between;align-items:flex-end;padding:0 16px;position:relative;flex-shrink:0}#extension-options-modal .tab{padding:12px 16px;color:#606266;display:flex;align-items:center;gap:8px;font-size:14px;cursor:pointer;border-radius:var(--rad)var(--rad)0 0;transition:background-color 0.2s ease;user-select:none}#extension-options-modal .tab.active,#extension-options-modal .tab.close-button{background-color:var(--background);border:var(--border-thickness)solid var(--border);border-bottom-color:var(--background);margin-bottom:-1px;z-index:1;color:#303133;font-weight:500}#extension-options-modal .tab.close-button{padding:8px}#extension-options-modal .tab.close-button:hover{background-color:#f5f7fa}#extension-options-modal .tab svg{stroke:currentColor}#extension-options-modal .tab.active svg{width:16px;height:16px}#extension-options-modal .tab.close-button svg{width:20px;height:20px}#extension-options-modal .modal-content{flex-grow:1;position:relative;border-radius:var(--rad);overflow:hidden;bottom:calc(var(--border-thickness)-1px);border:var(--border-thickness)solid var(--border)}#extension-options-modal .modal-content iframe{width:100%;height:100%;border:0;background:white}</style>`;modal.innerHTML=`<div class="modal-header"><div class="tab active"><img src="${iconSrc}" style="width:16px;height:16px;" onerror="this.style.display='none'"><span>${extensionName}</span></div><div class="tab close-button"><svg xmlns="http:<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div><div class="modal-content"><iframe></iframe></div>`;backdrop.appendChild(modal);backdrop.addEventListener("click",(e)=>{if(e.target===backdrop){closeOptionsModal()}});modal .querySelector(".tab.close-button").addEventListener("click",closeOptionsModal);document.body.appendChild(backdrop);iframe=modal.querySelector("iframe")}else{modal=backdrop.querySelector("#extension-options-modal");iframe=modal.querySelector("iframe");if(!iframe){iframe=document.createElement("iframe");modal.querySelector(".modal-content").appendChild(iframe)}backdrop.style.display="flex"}try{const polyfillString=generateCompletePolyfillForIframe();const doc=new DOMParser().parseFromString(html,"text/html");const script=doc.createElement("script");script.textContent=polyfillString;doc.head.insertAdjacentElement("afterbegin",script);iframe.srcdoc=doc.documentElement.outerHTML}catch(e){console.error("Error generating complete polyfill for iframe",e);iframe.srcdoc=html}}function generateCompletePolyfillForIframe(){const polyfillString='\n let newMap=JSON.parse(JSON.stringify(EXTENSION_ASSETS_MAP));delete newMap[OPTIONS_PAGE_PATH];return ` ${polyfillString.replaceAll("{{EXTENSION_ASSETS_MAP}}",`atob("${btoa(EXTENSION_ASSETS_MAP)}")`)}const polyfillCtx=buildPolyfill({isOtherPage:true});const APPLY_TO=[window,self,globalThis];for(const obj of APPLY_TO){obj.chrome=polyfillCtx.chrome;obj.browser=polyfillCtx.browser;obj.INJECTED_MANIFEST=${JSON.stringify(INJECTED_MANIFEST)}}`}async function main(){console.log(`[${SCRIPT_NAME}] Initializing...`);if(typeof _initStorage==="function"){try{await _initStorage();console.log(`[${SCRIPT_NAME}] Storage initialized.`)}catch(e){console.error("Error during storage initialization:",e)}}console.log(`[${SCRIPT_NAME}] Starting background scripts...`);const currentUrl=window.location.href;let shouldRunAnyScript=false;console.log(`[${SCRIPT_NAME}] Checking URL:${currentUrl}`);if(CONTENT_SCRIPT_CONFIGS_FOR_MATCHING&&CONTENT_SCRIPT_CONFIGS_FOR_MATCHING.length>0){for(const config of CONTENT_SCRIPT_CONFIGS_FOR_MATCHING){if(config.matches&&config.matches.some((pattern)=>{try{const regex=convertMatchPatternToRegExp(pattern);if(regex.test(currentUrl)){return true}return false}catch(e){console.error(`[${SCRIPT_NAME}] Error testing match pattern "${pattern}":`,e,);return false}})){shouldRunAnyScript=true;console.log(`[${SCRIPT_NAME}] URL match found via config:`,config);break}}}else{console.log(`[${SCRIPT_NAME}] No content script configurations found in manifest data.`,)}if(shouldRunAnyScript){let polyfillContext;try{polyfillContext=buildPolyfill({isBackground:false})}catch(e){console.error(`[${SCRIPT_NAME}] Failed to build polyfill:`,e);return}console.log(`[${SCRIPT_NAME}] Polyfill built. Executing combined script logic...`,);await executeAllScripts.call(polyfillContext.globalThis,polyfillContext,extensionCssData,)}else{console.log(`[${SCRIPT_NAME}] No matching content script patterns for this URL. No scripts will be executed.`,)}if(OPTIONS_PAGE_PATH){if(typeof _registerMenuCommand==="function"){try{_registerMenuCommand("Open Options",openOptionsPage);console.log(`[${SCRIPT_NAME}] Options menu command registered.`)}catch(e){console.error("Failed to register menu command",e)}}}if(POPUP_PAGE_PATH){if(typeof _registerMenuCommand==="function"){try{_registerMenuCommand("Open Popup",openPopupPage);console.log(`[${SCRIPT_NAME}] Popup menu command registered.`)}catch(e){console.error("Failed to register popup menu command",e)}}}console.log(`[${SCRIPT_NAME}] Initialization sequence complete.`)}main().catch((e)=>console.error(`[${SCRIPT_NAME}] Error during script initialization:`,e),);try{const fnKey="OPEN_OPTIONS_PAGE_"+String(SCRIPT_NAME).replace(/\s+/g,"_");window[fnKey]=openOptionsPage}catch(e){}try{const fnKey="OPEN_POPUP_PAGE_"+String(SCRIPT_NAME).replace(/\s+/g,"_");window[fnKey]=openPopupPage}catch(e){}})();